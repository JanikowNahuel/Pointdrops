<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>PointDrops - Catálogo de Ropa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: sans-serif;
            background-color: #f3f3f3;
            color: #333;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #111;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        .filter-buttons, .login-container, #admin-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 1rem;
            flex-wrap: wrap;
        }

        .filter-buttons button, .login-container button, #admin-actions button {
            padding: 0.5rem 1rem;
            background-color: #444;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .filter-buttons button:hover, .login-container button:hover, #admin-actions button:hover {
            background-color: #222;
        }

        .product-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            padding: 1rem;
        }

        .product-item {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: #e00;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.2rem 0.5rem;
            cursor: pointer;
        }

        input {
            padding: 0.5rem;
            margin: 0.25rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Bienvenido a PointDrops</h1>
        <p>Acá tenés el catálogo. Para cotización y consultas, contactanos por WhatsApp o Instagram.</p>
    </header>

    <div class="filter-buttons">
        <button onclick="filterByCategory('todas')">Todas</button>
        <button onclick="filterByCategory('remeras')">Remeras</button>
        <button onclick="filterByCategory('pantalones largos')">Pantalones Largos</button>
        <button onclick="filterByCategory('pantalones cortos')">Pantalones Cortos</button>
        <button onclick="filterByCategory('hoodies')">Hoodies</button>
        <button onclick="filterByCategory('camperas')">Camperas</button>
        <button onclick="filterByCategory('gorras')">Gorras</button>
        <button onclick="filterByCategory('accesorios')">Accesorios</button>
    </div>

    <div id="login" class="login-container">
        <input type="email" id="login-email" placeholder="Email">
        <input type="password" id="login-password" placeholder="Contraseña">
        <button onclick="login()">Iniciar sesión</button>
    </div>
    <div id="logout-container" style="display:none; text-align:center;">
        <button onclick="logout()">Cerrar sesión</button>
    </div>

    <div id="admin-actions" style="display:none; text-align:center; margin-bottom: 1rem;">
        <button onclick="showAddProductForm()">Agregar producto</button>
    </div>

    <div id="add-form" style="display:none; text-align:center; margin-bottom: 1rem;">
        <input type="text" id="product-name" placeholder="Nombre">
        <input type="text" id="product-category" placeholder="Categoría">
        <button onclick="addProduct()">Confirmar</button>
    </div>

    <div class="product-list" id="product-list"></div>

    <!-- Supabase y App JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        const supabaseUrl = 'https://hifmffqdooihgotquxnd.supabase.co'; // ← tu URL real
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhpZm1mZnFkb29paGdvdHF1eG5kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1OTAxMzQsImV4cCI6MjA2MjE2NjEzNH0.3nprN0B0wsXmpMFEaAbaZLLHvo3jUs4FwhZjkc4fxqo'; // ← tu clave pública
        const adminEmail = 'janikownahuel@gmail.com'; // ← tu correo admin
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        let allProducts = [];
        let isAdmin = false;

        async function fetchProducts() {
            const { data, error } = await supabase.from('productos').select('*');
            if (data) {
                allProducts = data;
                renderProducts(data);
            }
        }

        function renderProducts(products) {
            const container = document.getElementById('product-list');
            container.innerHTML = '';
            products.forEach(p => {
                const div = document.createElement('div');
                div.className = 'product-item';
                div.innerHTML = `
                    <h3>${p.nombre}</h3>
                    <p>${p.categoria}</p>
                    ${isAdmin ? `<button class="delete-btn" onclick="deleteProduct(${p.id})">X</button>` : ''}
                `;
                container.appendChild(div);
            });
        }

        function filterByCategory(categoria) {
            if (categoria === 'todas') {
                renderProducts(allProducts);
            } else {
                renderProducts(allProducts.filter(p => p.categoria === categoria));
            }
        }

        function showAddProductForm() {
            document.getElementById('add-form').style.display = 'block';
        }

        async function addProduct() {
            const nombre = document.getElementById('product-name').value;
            const categoria = document.getElementById('product-category').value;

            if (!nombre || !categoria) return alert('Completa todos los campos');

            const { error } = await supabase.from('productos').insert({ nombre, categoria });
            if (error) {
                alert('Error al agregar: ' + error.message);
            } else {
                alert('Producto agregado');
                document.getElementById('add-form').style.display = 'none';
                fetchProducts();
            }
        }

        async function deleteProduct(id) {
            if (!confirm('¿Eliminar este producto?')) return;
            const { error } = await supabase.from('productos').delete().eq('id', id);
            if (error) {
                alert('Error al eliminar: ' + error.message);
            } else {
                alert('Producto eliminado');
                fetchProducts();
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                alert('Error: ' + error.message);
            } else {
                alert('Sesión iniciada');
                document.getElementById('login').style.display = 'none';
                document.getElementById('logout-container').style.display = 'block';
                checkAdmin();
            }
        }

        async function logout() {
            await supabase.auth.signOut();
            alert('Sesión cerrada');
            document.getElementById('logout-container').style.display = 'none';
            document.getElementById('admin-actions').style.display = 'none';
            document.getElementById('add-form').style.display = 'none';
            document.getElementById('login').style.display = 'block';
            isAdmin = false;
            fetchProducts();
        }

        async function checkAdmin() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user && user.email === adminEmail) {
                isAdmin = true;
                document.getElementById('admin-actions').style.display = 'block';
            } else {
                isAdmin = false;
            }
            fetchProducts();
        }

        // Inicialización
        fetchProducts();
        checkAdmin();
    </script>
</body>
</html>
